<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GestiÃ³n de Equipo - Asobares</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', system-ui, sans-serif; }
    .kanban-card { transition: transform 0.2s, box-shadow 0.2s; cursor: grab; }
    .kanban-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    .kanban-card.dragging { opacity: 0.5; }
    .kanban-column.drag-over { background: #dbeafe !important; }
    .loading { display: inline-block; width: 20px; height: 20px; border: 3px solid #f3f3f3; border-top: 3px solid #E84338; border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;

    // SUPABASE CONFIG
    const SUPABASE_URL = 'https://pbqmkodwmntujezbokgo.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBicW1rb2R3bW50dWplemJva2dvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4NTQzOTIsImV4cCI6MjA4NjQzMDM5Mn0.C9sw9cix0J9Z2eTh-lr_4S6_gZmHIVwpzsxrZMCKl34';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const AsobaresLogo = ({ width = 280 }) => (<img src="logo.png" alt="Asobares" style={{ width, height: 'auto' }} />);
    const AsobaresLogoSmall = ({ width = 150 }) => (<img src="logo.png" alt="Asobares" style={{ width, height: 'auto' }} />);

    const cargos = ['DirecciÃ³n Ejecutiva', 'DirecciÃ³n de Proyectos', 'DirecciÃ³n ClÃºster DJ', 'DirecciÃ³n CÃ­rculo Gastro', 'Soporte Organizacional Afiliados', 'DiseÃ±o Web', 'Community Manager & Graf', 'DirecciÃ³n JurÃ­dica'];
    const ejesEstrategicos = ['Asobares', 'Proyectos', 'Cluster DJ', 'CÃ­rculo Gastro', 'Mi destino tu noche', 'Fontur', 'Alianza OSA', 'Asobares MedellÃ­n', 'FormaciÃ³n', 'Comunicaciones', 'Otro'];
    const meses = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
    const statusLabels = {
      'planeado': { label: 'Planeado', color: '#3b82f6', bg: '#dbeafe' },
      'en-curso': { label: 'En Curso', color: '#f59e0b', bg: '#fef3c7' },
      'completado': { label: 'Completado', color: '#10b981', bg: '#d1fae5' },
      'retrasado': { label: 'Retrasado', color: '#ef4444', bg: '#fee2e2' },
    };

    function App() {
      const [currentUser, setCurrentUser] = useState(null);
      const [users, setUsers] = useState([]);
      const [tasks, setTasks] = useState([]);
      const [loading, setLoading] = useState(true);
      const [view, setView] = useState('dashboard');
      const [showTaskModal, setShowTaskModal] = useState(false);
      const [showUserModal, setShowUserModal] = useState(false);
      const [editingUser, setEditingUser] = useState(null);
      const [editingTask, setEditingTask] = useState(null);
      const [filterMes, setFilterMes] = useState('all');
      const [filterEstado, setFilterEstado] = useState('all');
      const [filterUsuario, setFilterUsuario] = useState('all');
      const [searchTerm, setSearchTerm] = useState('');
      const [selectedMonth, setSelectedMonth] = useState(meses[new Date().getMonth()]);
      const [loginUsername, setLoginUsername] = useState('');
      const [loginPassword, setLoginPassword] = useState('');
      const [loginError, setLoginError] = useState('');
      const [notification, setNotification] = useState(null);
      const [draggedTask, setDraggedTask] = useState(null);

      useEffect(() => { loadData(); }, []);

      const loadData = async () => {
        setLoading(true);
        try {
          const { data: usersData } = await supabase.from('usuarios').select('*').order('id');
          const { data: tasksData } = await supabase.from('tareas').select('*').order('id', { ascending: false });
          setUsers(usersData || []);
          setTasks(tasksData || []);
          const saved = localStorage.getItem('asobares_user');
          if (saved) {
            const user = JSON.parse(saved);
            const fresh = usersData?.find(u => u.id === user.id);
            if (fresh) setCurrentUser(fresh);
          }
        } catch (e) { console.error(e); }
        setLoading(false);
      };

      const showNotif = (msg, type = 'success') => { setNotification({ msg, type }); setTimeout(() => setNotification(null), 3000); };

      const handleLogin = () => {
        const user = users.find(u => u.username === loginUsername && u.password === loginPassword);
        if (user) { setCurrentUser(user); localStorage.setItem('asobares_user', JSON.stringify(user)); setLoginError(''); showNotif(`Â¡Bienvenido, ${user.name}!`); }
        else setLoginError('Usuario o contraseÃ±a incorrectos');
      };

      const handleLogout = () => { setCurrentUser(null); localStorage.removeItem('asobares_user'); setView('dashboard'); };

      const handleSaveTask = async (data) => {
        try {
          const taskData = { mes: data.mes, cargo: data.cargo, responsable: data.responsable, proyecto: data.proyecto, eje_estrategico: data.ejeEstrategico, fecha_inicio: data.fechaInicio, fecha_fin: data.fechaFin, estado: data.estado, resultado: data.resultado, descripcion: data.descripcion, objetivo: data.objetivo };
          if (editingTask) {
            await supabase.from('tareas').update(taskData).eq('id', editingTask.id);
            showNotif('Tarea actualizada');
          } else {
            taskData.creado_por = currentUser.id;
            await supabase.from('tareas').insert(taskData);
            showNotif('Tarea creada');
          }
          await loadData();
          setShowTaskModal(false); setEditingTask(null);
        } catch (e) { showNotif('Error al guardar', 'error'); }
      };

      const handleDeleteTask = async (id) => {
        if (confirm('Â¿Eliminar tarea?')) {
          await supabase.from('tareas').delete().eq('id', id);
          await loadData(); showNotif('Tarea eliminada');
        }
      };

      const handleSaveUser = async (data) => {
        try {
          if (editingUser) {
            const upd = { name: data.name, username: data.username, cargo: data.cargo, avatar: data.avatar, role: data.role };
            if (data.password) upd.password = data.password;
            await supabase.from('usuarios').update(upd).eq('id', editingUser.id);
            if (currentUser.id === editingUser.id) { const u = { ...currentUser, ...upd }; setCurrentUser(u); localStorage.setItem('asobares_user', JSON.stringify(u)); }
            showNotif('Usuario actualizado');
          } else {
            await supabase.from('usuarios').insert({ username: data.username, name: data.name, password: data.password, role: data.role || 'user', cargo: data.cargo, avatar: data.avatar || 'ğŸ‘¤' });
            showNotif('Usuario creado');
          }
          await loadData(); setShowUserModal(false); setEditingUser(null);
        } catch (e) { showNotif('Error al guardar', 'error'); }
      };

      const handleDeleteUser = async (id) => {
        if (id === currentUser.id) return showNotif('No puedes eliminarte', 'error');
        if (confirm('Â¿Eliminar usuario?')) { await supabase.from('usuarios').delete().eq('id', id); await loadData(); showNotif('Usuario eliminado'); }
      };

      const handleUpdateStatus = async (id, status) => {
        await supabase.from('tareas').update({ estado: status }).eq('id', id);
        await loadData(); showNotif(`Movida a "${statusLabels[status].label}"`);
      };

      const handleDragStart = (e, task) => { setDraggedTask(task); e.target.classList.add('dragging'); };
      const handleDragEnd = (e) => { setDraggedTask(null); e.target.classList.remove('dragging'); };
      const handleDragOver = (e) => e.preventDefault();
      const handleDragEnter = (e) => { e.preventDefault(); e.currentTarget.classList.add('drag-over'); };
      const handleDragLeave = (e) => e.currentTarget.classList.remove('drag-over');
      const handleDrop = (e, status) => { e.preventDefault(); e.currentTarget.classList.remove('drag-over'); if (draggedTask) handleUpdateStatus(draggedTask.id, status); };

      const getMyTasks = () => {
        if (!currentUser) return [];
        if (currentUser.role === 'admin') return filterUsuario !== 'all' ? tasks.filter(t => t.responsable === parseInt(filterUsuario)) : tasks;
        return tasks.filter(t => t.responsable === currentUser.id);
      };

      const myTasks = getMyTasks();
      const filteredTasks = myTasks.filter(t => {
        if (filterMes !== 'all' && t.mes !== filterMes) return false;
        if (filterEstado !== 'all' && t.estado !== filterEstado) return false;
        if (searchTerm && !t.proyecto.toLowerCase().includes(searchTerm.toLowerCase())) return false;
        return true;
      });

      const assignedByMe = currentUser ? tasks.filter(t => t.creado_por === currentUser.id && t.responsable !== currentUser.id) : [];

      const getStats = (userId, month) => {
        const t = tasks.filter(x => x.responsable === userId && (!month || x.mes === month));
        const comp = t.filter(x => x.estado === 'completado').length;
        const ret = t.filter(x => new Date(x.fecha_fin) < new Date() && x.estado !== 'completado').length;
        return { total: t.length, completadas: comp, enCurso: t.filter(x => x.estado === 'en-curso').length, pendientes: t.filter(x => x.estado === 'planeado').length, retrasadas: ret, cumplimiento: t.length ? Math.round((comp / t.length) * 100) : 0 };
      };

      const myStats = currentUser ? getStats(currentUser.id, selectedMonth) : {};
      const globalStats = (() => {
        const t = tasks.filter(x => x.mes === selectedMonth);
        const comp = t.filter(x => x.estado === 'completado').length;
        const ret = t.filter(x => new Date(x.fecha_fin) < new Date() && x.estado !== 'completado').length;
        return { total: t.length, completadas: comp, enCurso: t.filter(x => x.estado === 'en-curso').length, pendientes: t.filter(x => x.estado === 'planeado').length, retrasadas: ret, cumplimiento: t.length ? Math.round((comp / t.length) * 100) : 0 };
      })();
      const userStats = users.filter(u => u.role !== 'admin').map(u => ({ ...u, ...getStats(u.id, selectedMonth) }));

      const currentMonth = meses[new Date().getMonth()];
      const currentYear = new Date().getFullYear();

      if (loading) return (<div style={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center', background: '#1a1a2e' }}><div style={{ textAlign: 'center', color: 'white' }}><div className="loading" style={{ width: 50, height: 50, margin: '0 auto 20px' }}></div><p>Cargando...</p></div></div>);

      if (!currentUser) return (
        <div style={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center', background: 'linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)', padding: 20 }}>
          <div style={{ background: 'white', borderRadius: 24, padding: 48, width: '100%', maxWidth: 440, boxShadow: '0 25px 60px rgba(232,67,56,0.25)' }}>
            <div style={{ textAlign: 'center', marginBottom: 40 }}>
              <AsobaresLogo width={260} />
              <div style={{ height: 1, background: 'linear-gradient(90deg, transparent, #E84338, transparent)', margin: '24px 0' }}></div>
              <h2 style={{ fontSize: 20, color: '#1a1a2e', fontWeight: 600 }}>GestiÃ³n de Equipo</h2>
            </div>
            <div>
              <div style={{ marginBottom: 20 }}>
                <label style={{ display: 'block', marginBottom: 8, fontSize: 14, fontWeight: 600, color: '#374151' }}>Usuario</label>
                <input type="text" value={loginUsername} onChange={e => setLoginUsername(e.target.value)} placeholder="nombre.apellido" style={{ width: '100%', padding: '14px 16px', borderRadius: 12, border: '2px solid #e5e7eb', fontSize: 16, boxSizing: 'border-box' }} />
              </div>
              <div style={{ marginBottom: 24 }}>
                <label style={{ display: 'block', marginBottom: 8, fontSize: 14, fontWeight: 600, color: '#374151' }}>ContraseÃ±a</label>
                <input type="password" value={loginPassword} onChange={e => setLoginPassword(e.target.value)} placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" onKeyDown={e => e.key === 'Enter' && handleLogin()} style={{ width: '100%', padding: '14px 16px', borderRadius: 12, border: '2px solid #e5e7eb', fontSize: 16, boxSizing: 'border-box' }} />
              </div>
              {loginError && <p style={{ color: '#E84338', fontSize: 14, marginBottom: 16, textAlign: 'center' }}>{loginError}</p>}
              <button onClick={handleLogin} style={{ width: '100%', padding: 16, borderRadius: 12, border: 'none', background: 'linear-gradient(135deg, #E84338, #c41e16)', color: 'white', fontSize: 16, fontWeight: 700, cursor: 'pointer' }}>Iniciar SesiÃ³n</button>
            </div>
            <div style={{ marginTop: 32, padding: 20, background: '#fef2f2', borderRadius: 12, border: '1px solid #fecaca' }}>
              <p style={{ fontSize: 13, fontWeight: 700, color: '#b91c1c', marginBottom: 8 }}>ğŸ”‘ Credenciales:</p>
              <p style={{ fontSize: 13, color: '#991b1b', fontFamily: 'monospace' }}>Admin: <b>admin</b> / <b>admin123</b></p>
              <p style={{ fontSize: 13, color: '#991b1b', fontFamily: 'monospace' }}>Usuario: <b>sebastian.henao</b> / <b>asobares123</b></p>
            </div>
          </div>
        </div>
      );

      return (
        <div style={{ display: 'flex', minHeight: '100vh', background: '#f8f9fa' }}>
          {notification && <div style={{ position: 'fixed', top: 24, right: 24, padding: '16px 28px', borderRadius: 12, background: notification.type === 'success' ? '#10b981' : '#E84338', color: 'white', fontWeight: 600, zIndex: 1000 }}>{notification.msg}</div>}

          {/* Sidebar */}
          <aside style={{ width: 280, background: 'linear-gradient(180deg, #1a1a2e, #16213e)', padding: '24px 16px', display: 'flex', flexDirection: 'column', position: 'fixed', height: '100vh' }}>
            <div style={{ padding: '0 8px 24px', borderBottom: '1px solid rgba(255,255,255,0.1)', marginBottom: 24 }}>
              <AsobaresLogoSmall width={150} />
              <p style={{ color: '#94a3b8', fontSize: 11, marginTop: 12, letterSpacing: 1 }}>GESTIÃ“N DE EQUIPO</p>
            </div>

            <nav style={{ display: 'flex', flexDirection: 'column', gap: 6, flex: 1 }}>
              {currentUser.role === 'admin' ? (
                <>
                  {[{ id: 'admin-dashboard', icon: 'ğŸ“Š', label: 'Dashboard General' }, { id: 'all-tasks', icon: 'ğŸ“‹', label: 'Todas las Tareas' }, { id: 'all-board', icon: 'ğŸ“Œ', label: 'Tablero General' }].map(item => (
                    <button key={item.id} onClick={() => setView(item.id)} style={{ display: 'flex', alignItems: 'center', gap: 12, padding: '14px 16px', borderRadius: 10, border: 'none', background: view === item.id ? 'linear-gradient(135deg, #E84338, #c41e16)' : 'transparent', color: view === item.id ? 'white' : '#94a3b8', fontSize: 15, fontWeight: view === item.id ? 600 : 400, cursor: 'pointer', textAlign: 'left' }}><span style={{ fontSize: 18 }}>{item.icon}</span>{item.label}</button>
                  ))}
                  <div style={{ height: 1, background: 'rgba(255,255,255,0.1)', margin: '16px 0' }}></div>
                  <p style={{ color: '#64748b', fontSize: 11, fontWeight: 600, padding: '0 16px', marginBottom: 8, letterSpacing: 1 }}>ADMINISTRACIÃ“N</p>
                  {[{ id: 'team', icon: 'ğŸ‘¥', label: 'GestiÃ³n de Equipo' }, { id: 'analytics', icon: 'ğŸ“ˆ', label: 'KPIs y EstadÃ­sticas' }].map(item => (
                    <button key={item.id} onClick={() => setView(item.id)} style={{ display: 'flex', alignItems: 'center', gap: 12, padding: '14px 16px', borderRadius: 10, border: 'none', background: view === item.id ? 'linear-gradient(135deg, #E84338, #c41e16)' : 'transparent', color: view === item.id ? 'white' : '#94a3b8', fontSize: 15, fontWeight: view === item.id ? 600 : 400, cursor: 'pointer', textAlign: 'left' }}><span style={{ fontSize: 18 }}>{item.icon}</span>{item.label}</button>
                  ))}
                </>
              ) : (
                <>
                  {[{ id: 'dashboard', icon: 'ğŸ“Š', label: 'Mi Dashboard' }, { id: 'tasks', icon: 'ğŸ“‹', label: 'Mis Tareas' }, { id: 'board', icon: 'ğŸ“Œ', label: 'Mi Tablero' }].map(item => (
                    <button key={item.id} onClick={() => setView(item.id)} style={{ display: 'flex', alignItems: 'center', gap: 12, padding: '14px 16px', borderRadius: 10, border: 'none', background: view === item.id ? 'linear-gradient(135deg, #E84338, #c41e16)' : 'transparent', color: view === item.id ? 'white' : '#94a3b8', fontSize: 15, fontWeight: view === item.id ? 600 : 400, cursor: 'pointer', textAlign: 'left' }}><span style={{ fontSize: 18 }}>{item.icon}</span>{item.label}</button>
                  ))}
                  <div style={{ height: 1, background: 'rgba(255,255,255,0.1)', margin: '16px 0' }}></div>
                  <button onClick={() => setView('assigned')} style={{ display: 'flex', alignItems: 'center', gap: 12, padding: '14px 16px', borderRadius: 10, border: 'none', background: view === 'assigned' ? 'linear-gradient(135deg, #E84338, #c41e16)' : 'transparent', color: view === 'assigned' ? 'white' : '#94a3b8', fontSize: 15, cursor: 'pointer', textAlign: 'left' }}><span style={{ fontSize: 18 }}>ğŸ“¤</span>Tareas Asignadas</button>
                </>
              )}
            </nav>

            <div style={{ borderTop: '1px solid rgba(255,255,255,0.1)', paddingTop: 16 }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: 12, padding: 12, background: 'rgba(255,255,255,0.05)', borderRadius: 10, marginBottom: 12 }}>
                <span style={{ fontSize: 32 }}>{currentUser.avatar}</span>
                <div><p style={{ color: 'white', fontSize: 14, fontWeight: 600 }}>{currentUser.name}</p><p style={{ color: '#E84338', fontSize: 11 }}>{currentUser.cargo}</p></div>
              </div>
              <button onClick={handleLogout} style={{ width: '100%', padding: 12, borderRadius: 10, border: '1px solid rgba(255,255,255,0.1)', background: 'transparent', color: '#94a3b8', cursor: 'pointer' }}>Cerrar SesiÃ³n</button>
            </div>
          </aside>

          {/* Main */}
          <main style={{ flex: 1, marginLeft: 280, padding: 32 }}>
            <header style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 32 }}>
              <div>
                <h1 style={{ fontSize: 28, fontWeight: 700, color: '#1a1a2e' }}>
                  {view === 'dashboard' && 'Mi Dashboard'}{view === 'tasks' && 'Mis Tareas'}{view === 'board' && 'Mi Tablero'}{view === 'assigned' && 'Tareas Asignadas'}
                  {view === 'admin-dashboard' && 'Dashboard General'}{view === 'all-tasks' && 'Todas las Tareas'}{view === 'all-board' && 'Tablero General'}
                  {view === 'team' && 'GestiÃ³n de Equipo'}{view === 'analytics' && 'KPIs y EstadÃ­sticas'}
                </h1>
                <p style={{ color: '#64748b', fontSize: 14, marginTop: 4 }}>{currentMonth} {currentYear}</p>
              </div>
              <div style={{ display: 'flex', gap: 16, alignItems: 'center' }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: 8, padding: '8px 16px', background: 'white', borderRadius: 10, border: '2px solid #e5e7eb' }}>
                  <span>ğŸ“…</span>
                  <select value={selectedMonth} onChange={e => setSelectedMonth(e.target.value)} style={{ border: 'none', fontSize: 14, fontWeight: 600, color: '#E84338', cursor: 'pointer', outline: 'none' }}>{meses.map(m => <option key={m} value={m}>{m}</option>)}</select>
                </div>
                <button onClick={() => { setEditingTask(null); setShowTaskModal(true); }} style={{ padding: '14px 28px', borderRadius: 10, border: 'none', background: 'linear-gradient(135deg, #E84338, #c41e16)', color: 'white', fontSize: 14, fontWeight: 700, cursor: 'pointer' }}>+ Nueva Tarea</button>
              </div>
            </header>

            {/* Admin Dashboard */}
            {view === 'admin-dashboard' && (
              <div>
                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(5, 1fr)', gap: 20, marginBottom: 32 }}>
                  {[{ icon: 'ğŸ“‹', val: globalStats.total, label: `Total ${selectedMonth}`, color: '#1a1a2e' }, { icon: 'âœ…', val: globalStats.completadas, label: 'Completadas', color: '#10b981' }, { icon: 'ğŸ”„', val: globalStats.enCurso, label: 'En Curso', color: '#f59e0b' }, { icon: 'ğŸ“', val: globalStats.pendientes, label: 'Pendientes', color: '#3b82f6' }, { icon: 'âš ï¸', val: globalStats.retrasadas, label: 'Retrasadas', color: '#E84338' }].map((s, i) => (
                    <div key={i} style={{ background: 'white', borderRadius: 16, padding: 24, boxShadow: '0 2px 8px rgba(0,0,0,0.04)', borderLeft: `4px solid ${s.color}` }}><span style={{ fontSize: 28 }}>{s.icon}</span><p style={{ fontSize: 36, fontWeight: 700, color: s.color, marginTop: 8 }}>{s.val}</p><p style={{ fontSize: 13, color: '#64748b', marginTop: 4 }}>{s.label}</p></div>
                  ))}
                </div>
                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 24 }}>
                  <div style={{ background: 'white', borderRadius: 16, padding: 24 }}>
                    <h2 style={{ fontSize: 16, fontWeight: 600, marginBottom: 20 }}>Cumplimiento - {selectedMonth}</h2>
                    <div style={{ display: 'flex', justifyContent: 'center' }}>
                      <div style={{ position: 'relative', width: 160, height: 160 }}>
                        <svg width="160" height="160" viewBox="0 0 160 160"><circle cx="80" cy="80" r="65" fill="none" stroke="#f1f5f9" strokeWidth="14" /><circle cx="80" cy="80" r="65" fill="none" stroke={globalStats.cumplimiento >= 70 ? '#10b981' : globalStats.cumplimiento >= 40 ? '#f59e0b' : '#E84338'} strokeWidth="14" strokeDasharray={`${(globalStats.cumplimiento / 100) * 408} 408`} strokeLinecap="round" transform="rotate(-90 80 80)" /></svg>
                        <div style={{ position: 'absolute', inset: 0, display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center' }}><span style={{ fontSize: 36, fontWeight: 700 }}>{globalStats.cumplimiento}%</span><span style={{ fontSize: 32 }}>{globalStats.cumplimiento >= 70 ? 'ğŸŸ¢' : globalStats.cumplimiento >= 40 ? 'ğŸŸ¡' : 'ğŸ”´'}</span></div>
                      </div>
                    </div>
                  </div>
                  <div style={{ background: 'white', borderRadius: 16, padding: 24 }}>
                    <h2 style={{ fontSize: 16, fontWeight: 600, marginBottom: 20 }}>Por Miembro</h2>
                    <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>
                      {userStats.sort((a, b) => b.cumplimiento - a.cumplimiento).slice(0, 5).map(m => (
                        <div key={m.id} style={{ display: 'flex', alignItems: 'center', gap: 12, padding: 10, background: '#f8f9fa', borderRadius: 10 }}>
                          <span style={{ fontSize: 24 }}>{m.avatar}</span>
                          <div style={{ flex: 1 }}><p style={{ fontSize: 13, fontWeight: 600 }}>{m.name}</p><div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 4 }}><div style={{ flex: 1, height: 6, background: '#e5e7eb', borderRadius: 3 }}><div style={{ height: '100%', width: `${m.cumplimiento}%`, background: m.cumplimiento >= 70 ? '#10b981' : m.cumplimiento >= 40 ? '#f59e0b' : '#E84338', borderRadius: 3 }}></div></div><span style={{ fontSize: 11, fontWeight: 600, color: m.cumplimiento >= 70 ? '#10b981' : m.cumplimiento >= 40 ? '#f59e0b' : '#E84338' }}>{m.cumplimiento}%</span></div></div>
                          <span>{m.cumplimiento >= 70 ? 'ğŸŸ¢' : m.cumplimiento >= 40 ? 'ğŸŸ¡' : 'ğŸ”´'}</span>
                        </div>
                      ))}
                    </div>
                  </div>
                </div>
              </div>
            )}

            {/* User Dashboard */}
            {view === 'dashboard' && (
              <div>
                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(5, 1fr)', gap: 20, marginBottom: 32 }}>
                  {[{ icon: 'ğŸ“‹', val: myStats.total || 0, label: `Tareas ${selectedMonth}`, color: '#1a1a2e' }, { icon: 'âœ…', val: myStats.completadas || 0, label: 'Completadas', color: '#10b981' }, { icon: 'ğŸ”„', val: myStats.enCurso || 0, label: 'En Curso', color: '#f59e0b' }, { icon: 'ğŸ“', val: myStats.pendientes || 0, label: 'Pendientes', color: '#3b82f6' }, { icon: 'âš ï¸', val: myStats.retrasadas || 0, label: 'Retrasadas', color: '#E84338' }].map((s, i) => (
                    <div key={i} style={{ background: 'white', borderRadius: 16, padding: 24, borderLeft: `4px solid ${s.color}` }}><span style={{ fontSize: 28 }}>{s.icon}</span><p style={{ fontSize: 36, fontWeight: 700, color: s.color, marginTop: 8 }}>{s.val}</p><p style={{ fontSize: 13, color: '#64748b', marginTop: 4 }}>{s.label}</p></div>
                  ))}
                </div>
                <div style={{ display: 'grid', gridTemplateColumns: '1fr 2fr', gap: 24 }}>
                  <div style={{ background: 'white', borderRadius: 16, padding: 24 }}>
                    <h2 style={{ fontSize: 16, fontWeight: 600, marginBottom: 20 }}>Mi Cumplimiento</h2>
                    <div style={{ display: 'flex', justifyContent: 'center' }}>
                      <div style={{ position: 'relative', width: 140, height: 140 }}>
                        <svg width="140" height="140" viewBox="0 0 140 140"><circle cx="70" cy="70" r="55" fill="none" stroke="#f1f5f9" strokeWidth="12" /><circle cx="70" cy="70" r="55" fill="none" stroke={myStats.cumplimiento >= 70 ? '#10b981' : myStats.cumplimiento >= 40 ? '#f59e0b' : '#E84338'} strokeWidth="12" strokeDasharray={`${((myStats.cumplimiento || 0) / 100) * 345} 345`} strokeLinecap="round" transform="rotate(-90 70 70)" /></svg>
                        <div style={{ position: 'absolute', inset: 0, display: 'flex', alignItems: 'center', justifyContent: 'center' }}><span style={{ fontSize: 32, fontWeight: 700 }}>{myStats.cumplimiento || 0}%</span></div>
                      </div>
                    </div>
                  </div>
                  <div style={{ background: 'white', borderRadius: 16, padding: 24 }}>
                    <h2 style={{ fontSize: 16, fontWeight: 600, marginBottom: 20 }}>Tareas Pendientes</h2>
                    {myTasks.filter(t => t.mes === selectedMonth && t.estado !== 'completado').slice(0, 5).map(t => (
                      <div key={t.id} style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: 14, background: '#f8f9fa', borderRadius: 10, marginBottom: 12 }}>
                        <div><p style={{ fontSize: 14, fontWeight: 600 }}>{t.proyecto}</p><p style={{ fontSize: 12, color: '#64748b', marginTop: 4 }}>Vence: {t.fecha_fin}</p></div>
                        <span style={{ padding: '6px 12px', borderRadius: 20, fontSize: 11, fontWeight: 600, background: statusLabels[t.estado]?.bg, color: statusLabels[t.estado]?.color }}>{statusLabels[t.estado]?.label}</span>
                      </div>
                    ))}
                    {myTasks.filter(t => t.mes === selectedMonth && t.estado !== 'completado').length === 0 && <p style={{ textAlign: 'center', color: '#64748b', padding: 20 }}>ğŸ‰ Â¡Sin tareas pendientes!</p>}
                  </div>
                </div>
              </div>
            )}

            {/* Tasks List */}
            {(view === 'tasks' || view === 'all-tasks') && (
              <div>
                <div style={{ display: 'flex', gap: 16, marginBottom: 24, flexWrap: 'wrap' }}>
                  <input type="text" placeholder="ğŸ” Buscar..." value={searchTerm} onChange={e => setSearchTerm(e.target.value)} style={{ flex: 1, minWidth: 200, padding: '12px 16px', borderRadius: 10, border: '2px solid #e5e7eb', fontSize: 14 }} />
                  <select value={filterMes} onChange={e => setFilterMes(e.target.value)} style={{ padding: '12px 16px', borderRadius: 10, border: '2px solid #e5e7eb', fontSize: 14, background: 'white' }}><option value="all">Todos los meses</option>{meses.map(m => <option key={m} value={m}>{m}</option>)}</select>
                  {currentUser.role === 'admin' && <select value={filterUsuario} onChange={e => setFilterUsuario(e.target.value)} style={{ padding: '12px 16px', borderRadius: 10, border: '2px solid #e5e7eb', fontSize: 14, background: 'white' }}><option value="all">Todos</option>{users.filter(u => u.role !== 'admin').map(u => <option key={u.id} value={u.id}>{u.name}</option>)}</select>}
                  <select value={filterEstado} onChange={e => setFilterEstado(e.target.value)} style={{ padding: '12px 16px', borderRadius: 10, border: '2px solid #e5e7eb', fontSize: 14, background: 'white' }}><option value="all">Todos estados</option>{Object.entries(statusLabels).map(([k, v]) => <option key={k} value={k}>{v.label}</option>)}</select>
                </div>
                <div style={{ background: 'white', borderRadius: 16, overflow: 'hidden' }}>
                  <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                    <thead><tr style={{ background: '#f8f9fa' }}><th style={{ padding: 16, textAlign: 'left', fontSize: 12, fontWeight: 700, color: '#64748b' }}>PROYECTO</th>{currentUser.role === 'admin' && <th style={{ padding: 16, textAlign: 'left', fontSize: 12, fontWeight: 700, color: '#64748b' }}>RESPONSABLE</th>}<th style={{ padding: 16, textAlign: 'left', fontSize: 12, fontWeight: 700, color: '#64748b' }}>FECHAS</th><th style={{ padding: 16, textAlign: 'left', fontSize: 12, fontWeight: 700, color: '#64748b' }}>ESTADO</th><th style={{ padding: 16 }}></th></tr></thead>
                    <tbody>
                      {filteredTasks.map(t => {
                        const resp = users.find(u => u.id === t.responsable);
                        return (
                          <tr key={t.id} style={{ borderTop: '1px solid #f1f5f9' }}>
                            <td style={{ padding: 16 }}><p style={{ fontSize: 14, fontWeight: 600 }}>{t.proyecto}</p><p style={{ fontSize: 12, color: '#64748b', marginTop: 4 }}>{t.eje_estrategico}</p></td>
                            {currentUser.role === 'admin' && <td style={{ padding: 16 }}><div style={{ display: 'flex', alignItems: 'center', gap: 8 }}><span style={{ fontSize: 20 }}>{resp?.avatar}</span><span style={{ fontSize: 13 }}>{resp?.name}</span></div></td>}
                            <td style={{ padding: 16 }}><p style={{ fontSize: 12 }}>ğŸ“… {t.fecha_inicio}</p><p style={{ fontSize: 12, color: '#64748b' }}>ğŸ {t.fecha_fin}</p></td>
                            <td style={{ padding: 16 }}><span style={{ padding: '6px 12px', borderRadius: 20, fontSize: 11, fontWeight: 600, background: statusLabels[t.estado]?.bg, color: statusLabels[t.estado]?.color }}>{statusLabels[t.estado]?.label}</span></td>
                            <td style={{ padding: 16 }}><button onClick={() => { setEditingTask(t); setShowTaskModal(true); }} style={{ padding: '8px 12px', borderRadius: 8, border: 'none', background: '#f1f5f9', cursor: 'pointer', marginRight: 8 }}>âœï¸</button><button onClick={() => handleDeleteTask(t.id)} style={{ padding: '8px 12px', borderRadius: 8, border: 'none', background: '#fee2e2', cursor: 'pointer' }}>ğŸ—‘ï¸</button></td>
                          </tr>
                        );
                      })}
                    </tbody>
                  </table>
                  {filteredTasks.length === 0 && <p style={{ textAlign: 'center', padding: 48, color: '#64748b' }}>No hay tareas</p>}
                </div>
              </div>
            )}

            {/* Kanban */}
            {(view === 'board' || view === 'all-board') && (
              <div>
                {currentUser.role === 'admin' && <div style={{ marginBottom: 20 }}><select value={filterUsuario} onChange={e => setFilterUsuario(e.target.value)} style={{ padding: '12px 16px', borderRadius: 10, border: '2px solid #e5e7eb', fontSize: 14, background: 'white' }}><option value="all">Todos</option>{users.filter(u => u.role !== 'admin').map(u => <option key={u.id} value={u.id}>{u.avatar} {u.name}</option>)}</select></div>}
                <p style={{ color: '#64748b', marginBottom: 20 }}>ğŸ’¡ Arrastra las tarjetas para cambiar estado</p>
                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: 20 }}>
                  {Object.entries(statusLabels).map(([key, val]) => {
                    const col = myTasks.filter(t => t.estado === key);
                    return (
                      <div key={key} className="kanban-column" onDragOver={handleDragOver} onDragEnter={handleDragEnter} onDragLeave={handleDragLeave} onDrop={e => handleDrop(e, key)} style={{ background: '#f1f5f9', borderRadius: 16, padding: 16, minHeight: 400 }}>
                        <div style={{ background: 'white', borderRadius: 12, padding: 14, marginBottom: 16, borderTop: `4px solid ${val.color}` }}><div style={{ display: 'flex', justifyContent: 'space-between' }}><h3 style={{ fontSize: 14, fontWeight: 700 }}>{val.label}</h3><span style={{ background: val.bg, color: val.color, padding: '4px 12px', borderRadius: 20, fontSize: 12, fontWeight: 700 }}>{col.length}</span></div></div>
                        <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>
                          {col.map(t => {
                            const resp = users.find(u => u.id === t.responsable);
                            return (
                              <div key={t.id} className="kanban-card" draggable onDragStart={e => handleDragStart(e, t)} onDragEnd={handleDragEnd} onClick={() => { setEditingTask(t); setShowTaskModal(true); }} style={{ background: 'white', borderRadius: 12, padding: 16 }}>
                                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 8 }}><span style={{ padding: '4px 8px', borderRadius: 6, fontSize: 10, fontWeight: 600, background: '#f1f5f9', color: '#475569' }}>{t.eje_estrategico}</span>{currentUser.role === 'admin' && <span>{resp?.avatar}</span>}</div>
                                <h4 style={{ fontSize: 14, fontWeight: 600, margin: '8px 0' }}>{t.proyecto}</h4>
                                <p style={{ fontSize: 10, color: '#94a3b8' }}>ğŸ {t.fecha_fin}</p>
                              </div>
                            );
                          })}
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            )}

            {/* Assigned */}
            {view === 'assigned' && (
              <div>
                <p style={{ color: '#64748b', marginBottom: 20 }}>Tareas que asignaste a otros</p>
                <div style={{ background: 'white', borderRadius: 16, overflow: 'hidden' }}>
                  <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                    <thead><tr style={{ background: '#f8f9fa' }}><th style={{ padding: 16, textAlign: 'left', fontSize: 12, fontWeight: 700, color: '#64748b' }}>PROYECTO</th><th style={{ padding: 16, textAlign: 'left', fontSize: 12, fontWeight: 700, color: '#64748b' }}>ASIGNADO A</th><th style={{ padding: 16, textAlign: 'left', fontSize: 12, fontWeight: 700, color: '#64748b' }}>FECHA</th><th style={{ padding: 16, textAlign: 'left', fontSize: 12, fontWeight: 700, color: '#64748b' }}>ESTADO</th></tr></thead>
                    <tbody>
                      {assignedByMe.map(t => {
                        const resp = users.find(u => u.id === t.responsable);
                        return (<tr key={t.id} style={{ borderTop: '1px solid #f1f5f9' }}><td style={{ padding: 16, fontWeight: 600 }}>{t.proyecto}</td><td style={{ padding: 16 }}><span style={{ fontSize: 20 }}>{resp?.avatar}</span> {resp?.name}</td><td style={{ padding: 16 }}>{t.fecha_fin}</td><td style={{ padding: 16 }}><span style={{ padding: '6px 12px', borderRadius: 20, fontSize: 11, fontWeight: 600, background: statusLabels[t.estado]?.bg, color: statusLabels[t.estado]?.color }}>{statusLabels[t.estado]?.label}</span></td></tr>);
                      })}
                    </tbody>
                  </table>
                  {assignedByMe.length === 0 && <p style={{ textAlign: 'center', padding: 48, color: '#64748b' }}>No has asignado tareas</p>}
                </div>
              </div>
            )}

            {/* Team */}
            {view === 'team' && (
              <div>
                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 24 }}><h2 style={{ fontSize: 18, fontWeight: 600 }}>Equipo</h2><button onClick={() => { setEditingUser(null); setShowUserModal(true); }} style={{ padding: '12px 24px', borderRadius: 10, border: 'none', background: 'linear-gradient(135deg, #E84338, #c41e16)', color: 'white', fontWeight: 600, cursor: 'pointer' }}>+ AÃ±adir</button></div>
                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(300px, 1fr))', gap: 20 }}>
                  {users.map(u => {
                    const s = getStats(u.id, selectedMonth);
                    return (
                      <div key={u.id} style={{ background: 'white', borderRadius: 16, padding: 24 }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 16 }}>
                          <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}><span style={{ fontSize: 40 }}>{u.avatar}</span><div><h3 style={{ fontSize: 16, fontWeight: 700 }}>{u.name}</h3><p style={{ fontSize: 12, color: '#E84338' }}>{u.cargo}</p><p style={{ fontSize: 11, color: '#94a3b8' }}>@{u.username}</p></div></div>
                          <span style={{ padding: '4px 10px', borderRadius: 12, fontSize: 10, fontWeight: 600, background: u.role === 'admin' ? '#fee2e2' : '#f1f5f9', color: u.role === 'admin' ? '#E84338' : '#64748b', height: 'fit-content' }}>{u.role === 'admin' ? 'Admin' : 'Usuario'}</span>
                        </div>
                        {u.role !== 'admin' && <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: 8, padding: '12px 0', borderTop: '1px solid #f1f5f9', borderBottom: '1px solid #f1f5f9' }}><div style={{ textAlign: 'center' }}><p style={{ fontSize: 18, fontWeight: 700 }}>{s.total}</p><p style={{ fontSize: 9, color: '#64748b' }}>Total</p></div><div style={{ textAlign: 'center' }}><p style={{ fontSize: 18, fontWeight: 700, color: '#10b981' }}>{s.completadas}</p><p style={{ fontSize: 9, color: '#64748b' }}>Hechas</p></div><div style={{ textAlign: 'center' }}><p style={{ fontSize: 18, fontWeight: 700, color: '#3b82f6' }}>{s.pendientes}</p><p style={{ fontSize: 9, color: '#64748b' }}>Pendientes</p></div><div style={{ textAlign: 'center' }}><p style={{ fontSize: 18, fontWeight: 700, color: '#E84338' }}>{s.retrasadas}</p><p style={{ fontSize: 9, color: '#64748b' }}>Retrasadas</p></div></div>}
                        <div style={{ display: 'flex', gap: 8, marginTop: 16 }}><button onClick={() => { setEditingUser(u); setShowUserModal(true); }} style={{ flex: 1, padding: 10, borderRadius: 8, border: '1px solid #e5e7eb', background: 'white', color: '#64748b', cursor: 'pointer' }}>âœï¸ Editar</button>{u.id !== currentUser.id && <button onClick={() => handleDeleteUser(u.id)} style={{ padding: 10, borderRadius: 8, border: 'none', background: '#fee2e2', color: '#E84338', cursor: 'pointer' }}>ğŸ—‘ï¸</button>}</div>
                      </div>
                    );
                  })}
                </div>
              </div>
            )}

            {/* Analytics */}
            {view === 'analytics' && (
              <div>
                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(5, 1fr)', gap: 20, marginBottom: 32 }}>
                  {[{ icon: 'ğŸ“‹', val: globalStats.total, label: `Total ${selectedMonth}`, color: '#1a1a2e' }, { icon: 'âœ…', val: globalStats.completadas, label: 'Completadas', color: '#10b981' }, { icon: 'ğŸ”„', val: globalStats.enCurso, label: 'En Curso', color: '#f59e0b' }, { icon: 'ğŸ“', val: globalStats.pendientes, label: 'Pendientes', color: '#3b82f6' }, { icon: 'âš ï¸', val: globalStats.retrasadas, label: 'No Cumplidas', color: '#E84338' }].map((s, i) => (
                    <div key={i} style={{ background: 'white', borderRadius: 16, padding: 20, borderLeft: `4px solid ${s.color}` }}><span style={{ fontSize: 24 }}>{s.icon}</span><p style={{ fontSize: 32, fontWeight: 700, color: s.color, marginTop: 8 }}>{s.val}</p><p style={{ fontSize: 12, color: '#64748b', marginTop: 4 }}>{s.label}</p></div>
                  ))}
                </div>
                <div style={{ background: 'white', borderRadius: 16, padding: 24 }}>
                  <h2 style={{ fontSize: 18, fontWeight: 600, marginBottom: 24 }}>Ranking - {selectedMonth}</h2>
                  <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                    <thead><tr style={{ background: '#f8f9fa' }}><th style={{ padding: 14, textAlign: 'left', fontSize: 12, fontWeight: 700, color: '#64748b' }}>#</th><th style={{ padding: 14, textAlign: 'left', fontSize: 12, fontWeight: 700, color: '#64748b' }}>RESPONSABLE</th><th style={{ padding: 14, textAlign: 'center', fontSize: 12, fontWeight: 700, color: '#64748b' }}>TOTAL</th><th style={{ padding: 14, textAlign: 'center', fontSize: 12, fontWeight: 700, color: '#64748b' }}>HECHAS</th><th style={{ padding: 14, textAlign: 'center', fontSize: 12, fontWeight: 700, color: '#64748b' }}>PEND.</th><th style={{ padding: 14, textAlign: 'center', fontSize: 12, fontWeight: 700, color: '#64748b' }}>RETR.</th><th style={{ padding: 14, textAlign: 'left', fontSize: 12, fontWeight: 700, color: '#64748b' }}>CUMPLIMIENTO</th><th style={{ padding: 14 }}></th></tr></thead>
                    <tbody>
                      {userStats.sort((a, b) => b.cumplimiento - a.cumplimiento).map((m, i) => (
                        <tr key={m.id} style={{ borderTop: '1px solid #f1f5f9' }}>
                          <td style={{ padding: 16, fontSize: 18 }}>{i === 0 ? 'ğŸ¥‡' : i === 1 ? 'ğŸ¥ˆ' : i === 2 ? 'ğŸ¥‰' : i + 1}</td>
                          <td style={{ padding: 16 }}><div style={{ display: 'flex', alignItems: 'center', gap: 12 }}><span style={{ fontSize: 24 }}>{m.avatar}</span><div><p style={{ fontWeight: 600 }}>{m.name}</p><p style={{ fontSize: 12, color: '#E84338' }}>{m.cargo}</p></div></div></td>
                          <td style={{ padding: 16, textAlign: 'center', fontWeight: 600 }}>{m.total}</td>
                          <td style={{ padding: 16, textAlign: 'center', fontWeight: 600, color: '#10b981' }}>{m.completadas}</td>
                          <td style={{ padding: 16, textAlign: 'center', fontWeight: 600, color: '#3b82f6' }}>{m.pendientes}</td>
                          <td style={{ padding: 16, textAlign: 'center', fontWeight: 600, color: '#E84338' }}>{m.retrasadas}</td>
                          <td style={{ padding: 16 }}><div style={{ display: 'flex', alignItems: 'center', gap: 12 }}><div style={{ flex: 1, height: 10, background: '#f1f5f9', borderRadius: 5 }}><div style={{ height: '100%', width: `${m.cumplimiento}%`, background: m.cumplimiento >= 70 ? '#10b981' : m.cumplimiento >= 40 ? '#f59e0b' : '#E84338', borderRadius: 5 }}></div></div><span style={{ fontWeight: 700, minWidth: 45, color: m.cumplimiento >= 70 ? '#10b981' : m.cumplimiento >= 40 ? '#f59e0b' : '#E84338' }}>{m.cumplimiento}%</span></div></td>
                          <td style={{ padding: 16, fontSize: 24 }}>{m.cumplimiento >= 70 ? 'ğŸŸ¢' : m.cumplimiento >= 40 ? 'ğŸŸ¡' : 'ğŸ”´'}</td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </div>
            )}
          </main>

          {showTaskModal && <TaskModal task={editingTask} users={users} currentUser={currentUser} onSave={handleSaveTask} onClose={() => { setShowTaskModal(false); setEditingTask(null); }} />}
          {showUserModal && <UserModal user={editingUser} cargos={cargos} onSave={handleSaveUser} onClose={() => { setShowUserModal(false); setEditingUser(null); }} />}
        </div>
      );
    }

    function TaskModal({ task, users, currentUser, onSave, onClose }) {
      const [mes, setMes] = useState(task?.mes || meses[new Date().getMonth()]);
      const [cargo, setCargo] = useState(task?.cargo || currentUser.cargo);
      const [responsable, setResponsable] = useState(task?.responsable || (currentUser.role === 'admin' ? users.find(u => u.role !== 'admin')?.id : currentUser.id));
      const [proyecto, setProyecto] = useState(task?.proyecto || '');
      const [ejeEstrategico, setEjeEstrategico] = useState(task?.eje_estrategico || ejesEstrategicos[0]);
      const [fechaInicio, setFechaInicio] = useState(task?.fecha_inicio || new Date().toISOString().split('T')[0]);
      const [fechaFin, setFechaFin] = useState(task?.fecha_fin || '');
      const [estado, setEstado] = useState(task?.estado || 'planeado');
      const [descripcion, setDescripcion] = useState(task?.descripcion || '');
      const [objetivo, setObjetivo] = useState(task?.objetivo || '');
      const [resultado, setResultado] = useState(task?.resultado || '');
      const inputStyle = { width: '100%', padding: '12px 14px', borderRadius: 10, border: '2px solid #e5e7eb', fontSize: 14, boxSizing: 'border-box' };
      return (
        <div style={{ position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.6)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 100, padding: 20 }}>
          <div style={{ background: 'white', borderRadius: 20, width: '100%', maxWidth: 600, maxHeight: '90vh', overflow: 'auto' }}>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: 24, background: 'linear-gradient(135deg, #E84338, #c41e16)', borderRadius: '20px 20px 0 0' }}><h2 style={{ fontSize: 20, fontWeight: 700, color: 'white' }}>{task ? 'âœï¸ Editar' : 'â• Nueva'} Tarea</h2><button onClick={onClose} style={{ width: 40, height: 40, borderRadius: 10, border: 'none', background: 'rgba(255,255,255,0.2)', fontSize: 20, color: 'white', cursor: 'pointer' }}>Ã—</button></div>
            <div style={{ padding: 24, display: 'flex', flexDirection: 'column', gap: 20 }}>
              <div><label style={{ display: 'block', marginBottom: 8, fontSize: 13, fontWeight: 600, color: '#374151' }}>Proyecto *</label><input type="text" value={proyecto} onChange={e => setProyecto(e.target.value)} style={inputStyle} /></div>
              <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 16 }}><div><label style={{ display: 'block', marginBottom: 8, fontSize: 13, fontWeight: 600, color: '#374151' }}>Mes</label><select value={mes} onChange={e => setMes(e.target.value)} style={inputStyle}>{meses.map(m => <option key={m} value={m}>{m}</option>)}</select></div><div><label style={{ display: 'block', marginBottom: 8, fontSize: 13, fontWeight: 600, color: '#374151' }}>Eje</label><select value={ejeEstrategico} onChange={e => setEjeEstrategico(e.target.value)} style={inputStyle}>{ejesEstrategicos.map(e => <option key={e} value={e}>{e}</option>)}</select></div></div>
              <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 16 }}><div><label style={{ display: 'block', marginBottom: 8, fontSize: 13, fontWeight: 600, color: '#374151' }}>Cargo</label><select value={cargo} onChange={e => setCargo(e.target.value)} style={inputStyle}>{cargos.map(c => <option key={c} value={c}>{c}</option>)}</select></div><div><label style={{ display: 'block', marginBottom: 8, fontSize: 13, fontWeight: 600, color: '#374151' }}>Asignar a</label><select value={responsable} onChange={e => setResponsable(e.target.value)} style={inputStyle}>{users.filter(u => u.role !== 'admin').map(u => <option key={u.id} value={u.id}>{u.avatar} {u.name}</option>)}</select></div></div>
              <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: 16 }}><div><label style={{ display: 'block', marginBottom: 8, fontSize: 13, fontWeight: 600, color: '#374151' }}>ğŸ“… Inicio</label><input type="date" value={fechaInicio} onChange={e => setFechaInicio(e.target.value)} style={inputStyle} /></div><div><label style={{ display: 'block', marginBottom: 8, fontSize: 13, fontWeight: 600, color: '#374151' }}>ğŸ Fin</label><input type="date" value={fechaFin} onChange={e => setFechaFin(e.target.value)} style={inputStyle} /></div><div><label style={{ display: 'block', marginBottom: 8, fontSize: 13, fontWeight: 600, color: '#374151' }}>Estado</label><select value={estado} onChange={e => setEstado(e.target.value)} style={inputStyle}>{Object.entries(statusLabels).map(([k, v]) => <option key={k} value={k}>{v.label}</option>)}</select></div></div>
              <div><label style={{ display: 'block', marginBottom: 8, fontSize: 13, fontWeight: 600, color: '#374151' }}>DescripciÃ³n</label><textarea value={descripcion} onChange={e => setDescripcion(e.target.value)} rows={2} style={{ ...inputStyle, resize: 'vertical', fontFamily: 'inherit' }} /></div>
              <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 16 }}><div><label style={{ display: 'block', marginBottom: 8, fontSize: 13, fontWeight: 600, color: '#374151' }}>Objetivo</label><input type="text" value={objetivo} onChange={e => setObjetivo(e.target.value)} style={inputStyle} /></div><div><label style={{ display: 'block', marginBottom: 8, fontSize: 13, fontWeight: 600, color: '#374151' }}>Resultado</label><input type="text" value={resultado} onChange={e => setResultado(e.target.value)} style={inputStyle} /></div></div>
              <div style={{ display: 'flex', gap: 12, justifyContent: 'flex-end' }}><button onClick={onClose} style={{ padding: '12px 24px', borderRadius: 10, border: '2px solid #e5e7eb', background: 'white', color: '#64748b', fontWeight: 600, cursor: 'pointer' }}>Cancelar</button><button onClick={() => { if (proyecto.trim()) onSave({ mes, cargo, responsable: parseInt(responsable), proyecto, ejeEstrategico, fechaInicio, fechaFin, estado, descripcion, objetivo, resultado }); }} style={{ padding: '12px 32px', borderRadius: 10, border: 'none', background: 'linear-gradient(135deg, #E84338, #c41e16)', color: 'white', fontWeight: 700, cursor: 'pointer' }}>{task ? 'Guardar' : 'Crear'}</button></div>
            </div>
          </div>
        </div>
      );
    }

    function UserModal({ user, cargos, onSave, onClose }) {
      const emojis = ['ğŸ‘¤', 'ğŸ‘¨', 'ğŸ‘©', 'ğŸ§‘', 'ğŸ‘¨â€ğŸ’¼', 'ğŸ‘©â€ğŸ’¼', 'ğŸ‘¨â€ğŸ’»', 'ğŸ‘©â€ğŸ’»', 'ğŸ¨', 'ğŸµ', 'ğŸ‘¨â€ğŸ³', 'ğŸ“±', 'âš–ï¸'];
      const [name, setName] = useState(user?.name || '');
      const [username, setUsername] = useState(user?.username || '');
      const [password, setPassword] = useState('');
      const [cargo, setCargo] = useState(user?.cargo || cargos[0]);
      const [avatar, setAvatar] = useState(user?.avatar || 'ğŸ‘¤');
      const [role, setRole] = useState(user?.role || 'user');
      const inputStyle = { width: '100%', padding: '12px 14px', borderRadius: 10, border: '2px solid #e5e7eb', fontSize: 14, boxSizing: 'border-box' };
      return (
        <div style={{ position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.6)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 100 }}>
          <div style={{ background: 'white', borderRadius: 20, width: '100%', maxWidth: 500, maxHeight: '90vh', overflow: 'auto' }}>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: 24, background: 'linear-gradient(135deg, #E84338, #c41e16)', borderRadius: '20px 20px 0 0' }}><h2 style={{ fontSize: 20, fontWeight: 700, color: 'white' }}>{user ? 'âœï¸ Editar' : 'ğŸ‘¤ Nuevo'} Usuario</h2><button onClick={onClose} style={{ width: 40, height: 40, borderRadius: 10, border: 'none', background: 'rgba(255,255,255,0.2)', fontSize: 20, color: 'white', cursor: 'pointer' }}>Ã—</button></div>
            <div style={{ padding: 24, display: 'flex', flexDirection: 'column', gap: 20 }}>
              <div><label style={{ display: 'block', marginBottom: 8, fontSize: 13, fontWeight: 600, color: '#374151' }}>Emoji</label><div style={{ display: 'flex', flexWrap: 'wrap', gap: 8, padding: 12, background: '#f8f9fa', borderRadius: 10 }}>{emojis.map(e => <button key={e} type="button" onClick={() => setAvatar(e)} style={{ width: 40, height: 40, borderRadius: 10, border: avatar === e ? '2px solid #E84338' : '2px solid transparent', background: avatar === e ? '#fee2e2' : 'white', fontSize: 20, cursor: 'pointer' }}>{e}</button>)}</div></div>
              <div><label style={{ display: 'block', marginBottom: 8, fontSize: 13, fontWeight: 600, color: '#374151' }}>Nombre *</label><input type="text" value={name} onChange={e => setName(e.target.value)} style={inputStyle} /></div>
              <div><label style={{ display: 'block', marginBottom: 8, fontSize: 13, fontWeight: 600, color: '#374151' }}>Usuario *</label><input type="text" value={username} onChange={e => setUsername(e.target.value)} style={inputStyle} /></div>
              <div><label style={{ display: 'block', marginBottom: 8, fontSize: 13, fontWeight: 600, color: '#374151' }}>{user ? 'Nueva ContraseÃ±a (opcional)' : 'ContraseÃ±a *'}</label><input type="password" value={password} onChange={e => setPassword(e.target.value)} style={inputStyle} /></div>
              <div style={{ display: 'grid', gridTemplateColumns: '2fr 1fr', gap: 16 }}><div><label style={{ display: 'block', marginBottom: 8, fontSize: 13, fontWeight: 600, color: '#374151' }}>Cargo</label><select value={cargo} onChange={e => setCargo(e.target.value)} style={inputStyle}>{cargos.map(c => <option key={c} value={c}>{c}</option>)}</select></div><div><label style={{ display: 'block', marginBottom: 8, fontSize: 13, fontWeight: 600, color: '#374151' }}>Rol</label><select value={role} onChange={e => setRole(e.target.value)} style={inputStyle}><option value="user">Usuario</option><option value="admin">Admin</option></select></div></div>
              <div style={{ display: 'flex', gap: 12, justifyContent: 'flex-end' }}><button onClick={onClose} style={{ padding: '12px 24px', borderRadius: 10, border: '2px solid #e5e7eb', background: 'white', color: '#64748b', fontWeight: 600, cursor: 'pointer' }}>Cancelar</button><button onClick={() => { if (name.trim() && username.trim() && (user || password.trim())) onSave({ name, username, password: password || undefined, cargo, avatar, role }); }} style={{ padding: '12px 32px', borderRadius: 10, border: 'none', background: 'linear-gradient(135deg, #E84338, #c41e16)', color: 'white', fontWeight: 700, cursor: 'pointer' }}>{user ? 'Guardar' : 'Crear'}</button></div>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
